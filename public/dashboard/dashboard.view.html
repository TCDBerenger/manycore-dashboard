<div class="row dashboard">
	<ng-include src="'/template_profile.html'" ng-if="willProfile(0)" ng-init="pindex = 0"></ng-include>
	
	<!-- Main -->
	<div ng-class="{'col-xs-4': has1Profile(), 'col-xs-8': has2Profiles()}"><div class="row">
		<!-- Step analyse -->
		<div ng-if="isStepAnalyse()" class="col-auto" style="max-width: 510px;"><div class="block block-title">
			<span class="block-icon fa-stack">
				<i class="fa fa-circle fa-stack-2x"></i>
				<i class="fa fa-hand-o-right fa-stack-1x fa-inverse"></i>
			</span>
			<h2>Step 2</h2>
			<p>Check all the indicators. <span class="label label-info" tooltip-html="stepTooltipAnalyse">help</span></p>
			<p>If an indicator seems dubious, click on it to automatically show the relevant problem category and follow the investigation.</p>
		</div></div>
		
		<!-- States -->
		<!--<div ng-if="hasProfiles()" class="col-auto gauge" ng-repeat="gauge in catCommon.gauges">
			<div class="panel panel-default"  ng-class="{for2: has2Profiles(), big: gauge.isBig}">
				<div class="panel-heading"><h3 class="panel-title">{{gauge.title}}</h3></div>
				<div class="panel-body panel-body-gauge">
					<div class="panel-section" ng-repeat="profile in selectedProfiles">
						<proxy-link-directive ng-attr-graph="{{gauge.graph}}" class="widget-graph{{ gauge.isBig | iif : ' big' : ''}}"></proxy-link-directive>
					</div>
				</div>
				<div class="panel-body panel-body-title" ng-if="has2Profiles()">
					<div class="panel-section" ng-repeat="profile in selectedProfiles">
						{{profile.label}}
					</div>
				</div>
			</div>
		</div>-->
		
		<!-- Category -->
		<div ng-if="has2Profiles()" class="col-auto"><div class="block block-title"><!-- block-imp -->
			<span class="block-icon fa-stack">
				<i class="fa fa-circle fa-stack-2x"></i>
				<i class="fa fa-eye fa-stack-1x fa-inverse"></i>
			</span>
			<h2>Quick access</h2>
			<div class="category-group">
				<a ui-sref='detail({cat: category.tag, ids: encodeSelectedProfile()})' ng-repeat="category in categories | enabled"><button type="button" class="btn btn-link btn-xs"><i class="fa fa-{{category.icon}}"></i>{{category.title}}</button></a>
			</div>
		</div></div>
		
		<!-- Control -->
		<!--
		<div ng-if="has2Profiles()" class="col-auto ctrl"><div class="block">
			<span class="block-icon fa-stack">
				<i class="fa fa-circle fa-stack-2x"></i>
				<i class="fa fa-wrench fa-stack-1x fa-inverse"></i>
			</span>
			<p><a class="action" href ng-click="unselectAllProfiles()">
				<span class="fa-stack icon">
					<i class="fa fa-thumb-tack fa-stack-1x"></i>
					<i class="fa fa-ban fa-stack-2x"></i>
				</span><span class="text">deselect all</span>
			</a></p>
			<p><a class="action" href ng-click="invertProfiles()">
				<span class="fa-stack icon">
					<i class="fa fa-circle fa-stack-2x"></i>
					<i class="fa fa-exchange fa-stack-1x fa-inverse"></i>
				</span><span class="text">invert</span>
			</a></p>
		</div></div>
		-->
	</div></div>
	
	<ng-include src="'/template_profile.html'" ng-if="willProfile(1)" ng-init="pindex = 1"></ng-include>
	
	<!-- Control -->
	<div class="col-xs-5 col-over" ng-class="{'col-xs-offset-6': has1Profile()}" ng-if="canAddProfile()">

		<!-- Step 1 -->
		<div class="block block-title" ng-if="isStep1()">
			<span class="block-icon fa-stack">
				<i class="fa fa-circle fa-stack-2x"></i>
				<i class="fa fa-hand-o-right fa-stack-1x fa-inverse"></i>
			</span>
			<h2>Step 1</h2>
			<p>Select the sample you want to analyse.</p>
			<p><strong>Be careful.</strong> This tool is created for a research purpose and is in constant evolution.
			Graphs could contain some mistakes and data could be miscomputed.</p>
		</div>
		
		<!-- Step compare -->
		<div class="block block-title" ng-if="isStepCompare()">
			<span class="block-icon fa-stack">
				<i class="fa fa-circle fa-stack-2x"></i>
				<i class="fa fa-hand-o-right fa-stack-1x fa-inverse"></i>
			</span>
			<h2>Step 1 bis</h2>
			<p>Select another sample to compare with the first one.</p>
		</div>
		
		<!-- Disclamer -->
		<!--<div class="block block-title">
			<span class="block-icon fa-stack">
				<i class="fa fa-circle fa-stack-2x"></i>
				<i class="fa fa-info fa-stack-1x fa-inverse"></i>
			</span>
			<h2>Information</h2>
			<strong>Be careful.</strong> This tool is created for a research purpose and is in constant evolution.
			Graphs could contain some mistakes and data could be miscomputed.
		</div>-->
		
		<!-- Selection -->
		<div class="block block-title">
			<span class="block-icon fa-stack">
				<i class="fa fa-circle fa-stack-2x"></i>
				<i class="fa fa-thumb-tack fa-stack-1x fa-inverse"></i>
			</span>
			<h2>{{! hasSelectedProfile() | iif : "Select a sample" : "Compare with"}}</h2>
			<p class="profile-group">
				<button type="button" class="btn {{ profile.version < 4 | iif : 'btn-default' : 'btn-primary'}} btn-xs" ng-click="selectProfile(profile)" ng-repeat="profile in availableProfiles | enabled | orderBy : 'label'">{{profile.label}}</button>
			</p>
			<p>
				<button type="button" class="btn btn-default btn-xs"></button> some data are missing<br />
				<button type="button" class="btn btn-primary btn-xs"></button> in accordance with last data revision
			</p>
		</div>
	</div>
</div>

<div class="row dashboard category" ng-if="hasProfiles()" ng-repeat="category in categories | enabled">
	<!-- Strips (profile 1) -->
	<ng-include src="'/template_profile_strips.html'" ng-init="profile = selectedProfiles[0]"></ng-include>
	
	<!-- Main -->
	<div class="category-main" ng-class="{'col-xs-4': has1Profile(), 'col-xs-8': has2Profiles(), 'for1': has1Profile(), 'for2': has2Profiles()}">
		<!-- Title -->
		<div class="title"><hr/><i class="fa fa-{{category.icon}}"></i><span>{{category.title}}</span><i class="fa fa-{{category.icon}}"></i><hr/></div>
		
		<!-- Indicators -->
		<div class="row"><div class="profile{{$index+1}}" ng-class="{'col-xs-12': has1Profile(), 'col-xs-6': has2Profiles()}" ng-repeat="profile in selectedProfiles">
			<!-- Legend -->
			<div class="legend">
				<p ng-repeat="strip in category.strips" ng-init="legend = strip.deck.data[0]">
					<span class="legend-title" style="color: {{legend.fcolor}}"><span class="icon">â–®</span><span class="text">{{legend.label}}</span></span><br />
					<span class="legend-data">XX % (YY s)</span>
				</p>
			</div>
			
			<!-- Gauges -->
			<ng-include src="'/template_profile_gauges.html'"></ng-include>
		</div></div>
	
	</div>
		
	<!-- Strips (profile 2) -->
	<ng-include src="'/template_profile_strips.html'" ng-if="has2Profiles()" ng-init="profile = selectedProfiles[1]"></ng-include>
</div>

<!-- Profiles -->
<script type="text/ng-template" id="/template_profile.html">
	<!-- Waiting -->
	<div ng-if="waitProfile(pindex)" class="col-xs-2 ctrl"><div class="block">
		<span class="block-icon fa-stack">
			<i class="fa fa-circle fa-stack-2x"></i>
			<i class="fa fa-spinner fa-pulse fa-stack-1x fa-inverse"></i>
		</span>
		<strong>Retrieving data...</strong>
	</div></div>
	
	<!-- Profile -->
	<div ng-if="hasProfile(pindex)" class="col-xs-2 profile hovermodal"><div class="tile"  ng-init="profile = selectedProfiles[pindex]">

		<!-- main -->
		<div class="section section-title">
			<a class="pin hover-text" href ng-click="unselectProfile(profile)">
				<span class="text">deselect</span><span class="fa-stack fa-lg icon">
					<i class="fa fa-thumb-tack fa-stack-1x"></i>
					<i class="fa fa-ban fa-stack-2x"></i>
				</span>
			</a>
			<!--<a class="pin hover-text" href ng-click="invertProfiles()" ng-if="has2Profiles()">
				<span class="text">invert</span><span class="fa-stack fa-lg icon">
					<i class="fa fa-circle fa-stack-2x"></i>
					<i class="fa fa-exchange fa-stack-1x fa-inverse"></i>
				</span>
			</a>-->
			<h2>{{profile.label}}</h2>
			<p class="subtitle" tooltip="{{profile.desc}}" tooltip-placement="bottom" tooltip-trigger="mouseenter">
				{{profile.desc != null && profile.desc.length > 0 | iif : profile.desc : '&nbsp;' }}
			</p>
			
			<!-- stat -->
			<p><i class="fa fa-bar-chart"></i> <strong>duration:</strong> {{data[profile.id].info.duration}} ms</p>
			<!--<div class="progress progress-striped" ng-if="has2Profiles()" style="margin-top: -10px;"><div class="progress-bar progress-bar-info" style="width: {{durationPercent(profile)}}%;"></div></div>-->
		</div>
		
		<!-- <div class="section">
			TODO: sequence
		</div> -->
		
		<div class="section section-strip strip" ng-repeat="strip in catCommon.strips">
			<chart-strip class="widget-graph"></chart-strip>
		</div>
		
	</div></div>
</script>

<!-- Profiles - strips -->
<script type="text/ng-template" id="/template_profile_strips.html">
	<div class="col-xs-2 profile"><div class="tile">
		<div class="section-strip strip" ng-repeat="strip in category.strips">
			<a ui-sref='detail({cat: category.tag, ids: encodeSelectedProfile()})'>
				<chart-strip class="widget-graph"></chart-strip>
			</a>
		</div>
	</div></div>
</script>

<!-- Profiles - gauges -->
<script type="text/ng-template" id="/template_profile_gauges.html">
	<div class="gauge panel panel-default" ng-repeat="gauge in category.gauges" tooltip="{{gauge.title}}">
		<div class="panel-body">
			<proxy-link-directive ng-attr-graph="{{gauge.graph}}" class="widget-graph{{ gauge.isBig | iif : ' big' : ''}}"></proxy-link-directive>
		</div>
		<div class="panel-footer">{{gauge.title}}</div>
	</div>
</script>